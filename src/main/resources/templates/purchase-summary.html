<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Purchase Summary</title>
    <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}">
    <style>
        body {
            background-color: #f4f6f9;
        }

        .card {
            border-radius: 12px;
        }

        th {
            background-color: #0d6efd;
            color: white;
            vertical-align: middle;
            text-align: center;
        }

        td, th {
            font-size: 14px;
        }

        .total-row {
            background-color: #e9f7ef !important;
            font-weight: bold;
        }

        .highlight-due {
            background-color: #fff3cd;
            font-weight: bold;
            color: #dc3545;
        }

        .filter-label {
            font-weight: 500;
        }

        .table-wrapper {
            max-height: 70vh;
            overflow-y: auto;
        }

        .btn-back {
            margin-top: 20px;
        }
    </style>
</head>
<body>
<div class="container py-4">
    <div class="card shadow-sm p-4">
        <h4 class="text-center text-primary mb-3">üìä Purchase Summary</h4>

        <!-- Filters -->
        <form method="get" action="/purchase-summary" class="row g-3 mb-4">
            <div class="col-md-3">
                <label class="form-label filter-label">Seller</label>
                <select name="seller" class="form-select">
                    <option value="">All</option>
                    <option th:each="s : ${allSellers}" th:value="${s}" th:text="${s}" th:selected="${s} == ${seller}"></option>
                </select>
            </div>
            <div class="col-md-3">
                <label class="form-label filter-label">Warehouse</label>
                <select name="warehouse" class="form-select">
                    <option value="">All</option>
                    <option th:each="w : ${allWarehouses}" th:value="${w}" th:text="${w}" th:selected="${w} == ${warehouse}"></option>
                </select>
            </div>
            <div class="col-md-3">
                <label class="form-label filter-label">Commodity</label>
                <select name="commodity" class="form-select">
                    <option value="">All</option>
                    <option th:each="c : ${allCommodities}" th:value="${c}" th:text="${c}" th:selected="${c} == ${commodity}"></option>
                </select>
            </div>
            <div class="col-md-3 d-flex align-items-end">
                <button type="submit" class="btn btn-primary me-2">Apply Filter</button>
                <a th:href="@{/purchase-summary}" class="btn btn-outline-secondary">Reset</a>
            </div>
            <div class="d-flex justify-content-end mb-3 gap-2">
                <a th:href="@{/purchase-summary/export/excel(seller=${seller}, warehouse=${warehouse}, commodity=${commodity})}" class="btn btn-success">Export to Excel</a>
                <a th:href="@{/purchase-summary/export/pdf(seller=${seller}, warehouse=${warehouse}, commodity=${commodity})}" class="btn btn-danger">Export to PDF</a>
            </div>

        </form>

        <!-- Table -->
        <div class="table-responsive table-wrapper">
            <table class="table table-bordered table-hover table-striped align-middle">
                <thead>
                <tr>
                    <th>Seller</th>
                    <th>Warehouse</th>
                    <th>Commodity</th>
                    <th>Quantity</th>
                    <th>Reduction</th>
                    <th>Net Qty</th>
                    <th>Cost</th>
                    <th>Handling</th>
                    <th>Total Cost</th>
                    <th>Amount Paid</th>
                    <th class="text-danger">Payment Due</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="s : ${summaries}">
                    <td th:text="${s.seller}"></td>
                    <td th:text="${s.warehouse}"></td>
                    <td th:text="${s.commodity}"></td>
                    <td th:text="${s.quantity}"></td>
                    <td th:text="${s.reduction}"></td>
                    <td th:text="${s.netQty}"></td>
                    <td th:text="${s.cost}"></td>
                    <td th:text="${s.handling}"></td>
                    <td th:text="${s.totalCost}"></td>
                    <td th:text="${s.amount}"></td>
                    <td th:text="${s.paymentDue}" class="highlight-due"></td>
                </tr>
                </tbody>
                <tfoot>
                <tr class="total-row text-end">
                    <td colspan="3">TOTAL</td>
                    <td th:text="${totalQty}"></td>
                    <td th:text="${totalRed}"></td>
                    <td th:text="${totalNet}"></td>
                    <td th:text="${totalCost}"></td>
                    <td th:text="${totalHandling}"></td>
                    <td th:text="${totalFinal}"></td>
                    <td th:text="${totalPaid}"></td>
                    <td th:text="${totalDue}"></td>
                </tr>
                </tfoot>
            </table>
        </div>

        <!-- Back to Dashboard Button -->
        <div class="text-start btn-back">
            <a th:href="@{/}" class="btn btn-secondary">‚Üê Back to Dashboard</a>
        </div>
    </div>
</div>

<script th:src="@{/js/bootstrap.bundle.min.js}"></script>
</body>
</html>

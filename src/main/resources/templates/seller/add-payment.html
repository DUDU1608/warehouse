<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <title>Add Payment</title>
    <style>
        body { background: #f2f4f8; font-family: 'Segoe UI', Arial, sans-serif; margin: 0; }
        .container {
            max-width: 480px; margin: 38px auto; background: #fff; border-radius: 18px;
            box-shadow: 0 2px 32px rgba(60,72,95,0.13); padding: 32px 28px;
        }
        h2 { text-align: center; color: #274c97; margin-bottom: 24px; }
        label { font-weight: 500; color: #1a3262; margin-bottom: 3px; display: block; }
        input, select {
            width: 100%; padding: 8px 10px; margin-bottom: 17px;
            border: 1px solid #c6d0e7; border-radius: 7px; font-size: 1.06rem;
            background: #f7f9fc; color: #223052;
        }
        input:read-only { background: #f0f0f7; }
        button {
            width: 100%; padding: 12px 0; background: #234fc6; color: #fff;
            border: none; border-radius: 8px; font-size: 1.1rem; font-weight: 600; cursor: pointer;
            transition: background 0.2s;
        }
        button:hover { background: #10397e; }
        .back-btn {
            display:inline-block; margin-top:20px; background:#e8eef7; color:#23406e;
            padding:8px 20px; border-radius:8px; text-decoration:none; border:1px solid #d1dbe7;
            font-weight:500; transition: background .2s, color .2s; text-align: center;
        }
        @media (max-width: 600px) { .container { max-width: 98vw; padding: 4vw; } }
    </style>
    <script>
        // Seller name autocomplete and mobile auto-fill
        let sellerData = /*[[${sellerDataJson}]]*/ [];
        function onNameInput() {
            const nameInput = document.getElementById('name');
            const mobileInput = document.getElementById('mobile');
            const matched = sellerData.find(s => s.name === nameInput.value);
            mobileInput.value = matched ? matched.mobile : '';
        }
        // Warehouse autocomplete
        let warehouseList = /*[[${warehouseListJson}]]*/ [];
        function autocomplete(inp, arr) {
            let currentFocus;
            inp.addEventListener("input", function(e) {
                let a, b, i, val = this.value;
                closeAllLists();
                if (!val) return false;
                currentFocus = -1;
                a = document.createElement("DIV");
                a.setAttribute("id", this.id + "autocomplete-list");
                a.setAttribute("class", "autocomplete-items");
                this.parentNode.appendChild(a);
                for (i = 0; i < arr.length; i++) {
                    if (arr[i].substr(0, val.length).toUpperCase() == val.toUpperCase()) {
                        b = document.createElement("DIV");
                        b.innerHTML = "<strong>" + arr[i].substr(0, val.length) + "</strong>";
                        b.innerHTML += arr[i].substr(val.length);
                        b.innerHTML += "<input type='hidden' value='" + arr[i] + "'>";
                        b.addEventListener("click", function(e) {
                            inp.value = this.getElementsByTagName("input")[0].value;
                            closeAllLists();
                        });
                        a.appendChild(b);
                    }
                }
            });
            function closeAllLists(elmnt) {
                var x = document.getElementsByClassName("autocomplete-items");
                for (var i = 0; i < x.length; i++) {
                    if (elmnt != x[i] && elmnt != inp) x[i].parentNode.removeChild(x[i]);
                }
            }
            document.addEventListener("click", function (e) { closeAllLists(e.target); });
        }
        window.onload = function() {
            // Data passed from backend via Thymeleaf
            sellerData = /*[[${sellerDataJson}]]*/ [];
            warehouseList = /*[[${warehouseListJson}]]*/ [];
            autocomplete(document.getElementById("warehouse"), warehouseList);
        }
    </script>
</head>
<body>
<div class="container">
    <h2>Add Payment</h2>
    <form th:action="@{/seller/add-payment}" th:object="${payment}" method="post">
        <label for="date">Date</label>
        <input type="date" id="date" th:field="*{date}" required />

        <label for="name">Seller Name</label>
        <input type="text" id="name" th:field="*{name}" list="sellerNames" autocomplete="off" oninput="onNameInput()" required />
        <datalist id="sellerNames">
            <option th:each="seller : ${sellerData}" th:value="${seller.name}" />
        </datalist>

        <label for="mobile">Mobile Number</label>
        <input type="text" id="mobile" th:field="*{mobile}" readonly />

        <label for="warehouse">Warehouse</label>
        <input type="text" id="warehouse" th:field="*{warehouse}" list="warehouseList" autocomplete="off" required />
        <datalist id="warehouseList">
            <option th:each="w : ${warehouseList}" th:value="${w}" />
        </datalist>

        <label for="commodity">Commodity</label>
        <select id="commodity" th:field="*{commodity}" required>
            <option value="">Select</option>
            <option value="Wheat">Wheat</option>
            <option value="Maize">Maize</option>
            <option value="Paddy">Paddy</option>
        </select>

        <label for="amount">Amount</label>
        <input type="number" id="amount" th:field="*{amount}" step="0.01" min="0" required />

        <label for="bankReference">Bank Reference</label>
        <input type="text" id="bankReference" th:field="*{bankReference}" maxlength="60" />

        <button type="submit">Add Payment</button>
    </form>
    <a href="/seller" class="back-btn">&larr; Back to Seller Dashboard</a>
</div>
</body>
</html>

